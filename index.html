<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Firebass - å¤šäººçŒœæ•¸å­—</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --p: #6366f1; --accent: #ffd700; }
        body { 
            margin: 0; min-height: 100vh; font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1e1e2f 0%, #4e4376 100%);
            display: flex; align-items: center; justify-content: center; color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            padding: 2rem; border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            width: 90%; max-width: 380px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        h1 { font-size: 2rem; margin: 0; letter-spacing: 2px; }
        h1 span { color: var(--accent); }
        .subtitle { font-size: 0.8rem; opacity: 0.7; margin-bottom: 20px; }
        
        input {
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px;
            border: none; background: rgba(255, 255, 255, 0.2);
            color: white; font-size: 1rem; box-sizing: border-box; outline: none;
        }
        button {
            width: 100%; padding: 12px; margin-top: 10px; border-radius: 12px;
            border: none; background: white; color: #4e4376;
            font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        button:active { transform: scale(0.95); }
        button.sec { background: transparent; border: 1px solid white; color: white; margin-top: 8px; font-size: 0.8rem; }

        .history {
            margin-top: 20px; padding: 0; list-style: none;
            max-height: 200px; overflow-y: auto; text-align: left;
        }
        .item {
            background: rgba(255, 255, 255, 0.05); padding: 10px;
            border-radius: 10px; margin-bottom: 5px; font-size: 0.85rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .num-badge { color: var(--accent); font-weight: bold; font-size: 1.1rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="authBox">
        <h1>FIREB<span>ASS</span></h1>
        <p class="subtitle">å¤šäººå³æ™‚é€£ç·šå°æˆ°</p>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="å¯†ç¢¼ (è‡³å°‘ 6 ä½)">
        <button onclick="doAuth('login')">ç™»å…¥éŠæˆ²</button>
        <button class="sec" onclick="doAuth('signup')">è¨»å†Šæ–°ç©å®¶</button>
    </div>

    <div id="gameBox" class="hidden">
        <h2 id="userName" style="margin:0">ç©å®¶</h2>
        <p class="subtitle" id="hint">çŒœä¸€å€‹ 1-100 çš„æ•¸å­—</p>
        <input type="number" id="numInput" placeholder="è¼¸å…¥æ•¸å­—...">
        <button onclick="sendGuess()">é€å‡ºæ•¸å­—</button>
        <ul id="historyList" class="history"></ul>
        <button class="sec" onclick="doLogout()">ç™»å‡ºå¸³è™Ÿ</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    // ä½¿ç”¨ä½ æä¾›çš„é…ç½®èˆ‡è³‡æ–™åº«ç¶²å€
    const firebaseConfig = {
        apiKey: "AIzaSyCjjfEnkLeaRXZsFPVxjwDWxz1IqbOBN7A",
        authDomain: "nbms-3dc57.firebaseapp.com",
        projectId: "nbms-3dc57",
        storageBucket: "nbms-3dc57.firebasestorage.app",
        messagingSenderId: "495363300459",
        appId: "1:495363300459:web:5494e7f2d37c8a12e0252e",
        databaseURL: "https://nbms-3dc57-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    let target = 0;
    let myEmail = "";

    // è™•ç†ç™»å…¥è¨»å†Š
    window.doAuth = async (mode) => {
        const mail = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        if(!mail || pass.length < 6) return alert("è«‹è¼¸å…¥æ­£ç¢ºçš„ Email èˆ‡ 6 ä½å¯†ç¢¼");
        try {
            if(mode === 'signup') await createUserWithEmailAndPassword(auth, mail, pass);
            else await signInWithEmailAndPassword(auth, mail, pass);
        } catch(e) { alert(e.message); }
    };

    window.doLogout = () => signOut(auth);

    // ç›£è½ç™»å…¥ç‹€æ…‹
    onAuthStateChanged(auth, (user) => {
        if(user) {
            myEmail = user.email.split('@')[0];
            document.getElementById('authBox').classList.add('hidden');
            document.getElementById('gameBox').classList.remove('hidden');
            document.getElementById('userName').innerText = `ä½ å¥½, ${myEmail}`;
            playGame();
        } else {
            document.getElementById('authBox').classList.remove('hidden');
            document.getElementById('gameBox').classList.add('hidden');
        }
    });

    function playGame() {
        // ç²å–è¬é¡Œç­”æ¡ˆ
        onValue(ref(db, 'game/ans'), (s) => {
            target = s.val();
            if(!target) set(ref(db, 'game/ans'), Math.floor(Math.random() * 100) + 1);
        });

        // ç›£è½ç´€éŒ„
        onValue(ref(db, 'game/log'), (s) => {
            const list = document.getElementById('historyList');
            list.innerHTML = "";
            const data = s.val();
            if(!data) return;

            Object.values(data).sort((a,b) => b.t - a.t).forEach(g => {
                const li = document.createElement('li');
                li.className = 'item';
                const isWin = g.n == target;
                const hintText = isWin ? "ğŸ† çŒœä¸­äº†ï¼" : (g.n > target ? "å¤ªå¤§ â¬†ï¸" : "å¤ªå° â¬‡ï¸");
                li.innerHTML = `<div><b>${g.u}</b><br><small>${hintText}</small></div><div class="num-badge">${g.n}</div>`;
                list.appendChild(li);
            });
        });
    }

    window.sendGuess = () => {
        const el = document.getElementById('numInput');
        const num = parseInt(el.value);
        if(!num) return;
        push(ref(db, 'game/log'), { u: myEmail, n: num, t: Date.now() });
        el.value = "";
    };
</script>
</body>
</html>
