<!doctype html>
<html lang="zh-TW" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤šäººçŒœæ•¸å­—éŠæˆ² - ç®¡ç†å“¡ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Noto Sans TC', sans-serif; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.3); } 50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.6); } }
    @keyframes bounce-in { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
    .float-animation { animation: float 3s ease-in-out infinite; }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .bounce-in { animation: bounce-in 0.6s ease-out forwards; }
    .number-display { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); border: 3px solid #fbbf24; }
    .hint-higher { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .hint-lower { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .hint-correct { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-indigo-950 via-purple-900 to-indigo-900 overflow-auto">
  <div id="app" class="w-full min-h-full p-4 md:p-6">
    
    <div id="login-section" class="max-w-2xl mx-auto mb-6">
      <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
        <h2 class="text-amber-300 font-bold text-lg mb-4">ğŸ” ç™»å…¥éŠæˆ²</h2>
        <div class="space-y-3">
          <input type="text" id="login-account" placeholder="è¼¸å…¥å¸³è™Ÿ" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:border-amber-400">
          <input type="password" id="login-password" placeholder="è¼¸å…¥å¯†ç¢¼" class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:border-amber-400">
          <button onclick="loginGame()" class="w-full px-4 py-3 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-400 hover:to-yellow-400 text-indigo-950 font-bold rounded-xl transition-all transform active:scale-95">ç™»å…¥</button>
          <div id="login-error" class="text-red-400 text-sm hidden text-center"></div>
        </div>
      </div>
    </div>

    <header class="text-center mb-6">
      <h1 id="game-title" class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-amber-300 to-yellow-500 float-animation">ğŸ¯ å¤šäººçŒœæ•¸å­—éŠæˆ²</h1>
      <p id="welcome-msg" class="text-amber-200/80 mt-2 text-sm md:text-base">çŒœå‡º 1-100 ä¹‹é–“çš„ç¥ç§˜æ•¸å­—ï¼</p>
      <div id="login-status" class="text-amber-300 mt-2 font-bold hidden text-xl"></div>
    </header>

    <div class="max-w-4xl mx-auto">
      <div id="game-status" class="mb-6">
        <div class="number-display rounded-2xl p-6 text-center pulse-glow">
          <div class="text-amber-200/60 text-sm mb-2">ç¥ç§˜æ•¸å­—ç¯„åœ</div>
          <div id="range-display" class="text-4xl md:text-5xl font-black text-white">1 ~ 100</div>
          <div id="attempts-display" class="text-amber-300 mt-3 text-lg">ç¬¬ <span id="attempt-count">0</span> æ¬¡çŒœæ¸¬</div>
        </div>
      </div>

      <div id="hint-container" class="mb-6 hidden">
        <div id="hint-box" class="rounded-xl p-4 text-center text-white font-bold text-xl bounce-in"><span id="hint-text"></span></div>
      </div>

      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
          <h2 class="text-amber-300 font-bold text-lg mb-4">ğŸ‘¤ åŠ å…¥éŠæˆ²</h2>
          <div id="join-section" class="hidden">
            <div class="flex gap-3">
              <input type="text" id="player-name-input" placeholder="è¼¸å…¥ä½ çš„åå­—" class="flex-1 px-4 py-3 rounded-xl bg-white/10 border border-white/30 text-white placeholder-white/50 focus:outline-none">
              <button id="join-btn" onclick="joinGame()" class="px-6 py-3 bg-amber-500 text-indigo-950 font-bold rounded-xl transition-all hover:scale-105 active:scale-95">åŠ å…¥</button>
            </div>
            <div id="join-error" class="text-red-400 text-sm mt-2 hidden"></div>
          </div>
          <div id="joined-section" class="hidden text-center">
            <div class="text-amber-300 font-bold text-lg mb-3">ä½ å·²åŠ å…¥éŠæˆ² âœ“</div>
            <button onclick="changePlayerName()" class="w-full px-4 py-2 bg-white/10 text-white rounded-xl border border-white/20 hover:bg-white/20">ğŸ”„ æ›´æ”¹åå­—</button>
            <button onclick="logoutGame()" class="w-full px-4 py-2 bg-white/10 text-white rounded-xl border border-white/20 mt-2 hover:bg-white/20">ğŸšª ç™»å‡º</button>
          </div>
        </div>
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
          <h2 class="text-amber-300 font-bold text-lg mb-4">ğŸ® è¼ªåˆ°èª°ï¼Ÿ</h2>
          <div id="current-player-display" class="text-2xl font-bold text-white/50">ç­‰å¾…ç©å®¶åŠ å…¥...</div>
          <div id="player-count" class="text-amber-200/60 text-sm mt-2">ç›®å‰ 0 ä½ç©å®¶</div>
        </div>
      </div>

      <div id="guess-section" class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20 mb-6 hidden">
        <h2 class="text-amber-300 font-bold text-lg mb-4">ğŸ”¢ è¼¸å…¥ä½ çš„çŒœæ¸¬</h2>
        <div class="flex gap-3 items-center">
          <input type="number" id="guess-input" min="1" max="100" class="flex-1 px-4 py-4 rounded-xl bg-white/10 border border-white/30 text-white text-2xl text-center font-bold">
          <button id="guess-btn" onclick="makeGuess()" class="px-8 py-4 bg-green-500 text-white font-bold text-lg rounded-xl hover:scale-105 active:scale-95">çŒœï¼</button>
        </div>
        <div id="guess-error" class="text-red-400 text-sm mt-2 hidden"></div>
      </div>

      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
          <h2 class="text-amber-300 font-bold text-lg mb-4">ğŸ† æ’è¡Œæ¦œ</h2>
          <div id="leaderboard" class="space-y-3"><div class="text-white/50 text-center py-4">ç„¡è¨˜éŒ„</div></div>
        </div>
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
          <h2 class="text-amber-300 font-bold text-lg mb-4">ğŸ“œ çŒœæ¸¬è¨˜éŒ„</h2>
          <div id="guess-history" class="space-y-2 max-h-48 overflow-y-auto"><div class="text-white/50 text-center py-4">ç­‰å¾…é–‹å§‹</div></div>
        </div>
      </div>

      <div class="mt-6 flex justify-center gap-4">
        <button onclick="resetGame()" class="px-6 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-500">ğŸ”„ æ–°éŠæˆ²</button>
        <button onclick="openClearModal()" class="px-6 py-3 bg-white/10 text-white/80 rounded-xl border border-white/20 hover:bg-white/20">ğŸ—‘ï¸ æ¸…é™¤ç©å®¶</button>
      </div>
    </div>

    <div id="win-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50">
      <div class="bg-indigo-900 rounded-3xl p-8 border-2 border-amber-400 text-center bounce-in mx-4">
        <div class="text-6xl mb-4">ğŸ‰</div>
        <h2 id="win-message" class="text-3xl font-black text-amber-400 mb-2"></h2>
        <p id="win-details" class="text-white text-xl mb-6"></p>
        <button onclick="closeWinModal()" class="px-8 py-3 bg-amber-500 text-indigo-950 font-bold rounded-xl">å†ç©ä¸€å±€</button>
      </div>
    </div>

    <div id="clear-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50">
      <div class="bg-slate-800 rounded-2xl p-6 border border-white/20 w-80">
        <h3 class="text-white font-bold mb-4">âš ï¸ æ¸…é™¤æ‰€æœ‰ç©å®¶è¨˜éŒ„</h3>
        <input type="password" id="clear-password" placeholder="è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼" class="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/30 text-white mb-4">
        <div id="clear-error" class="text-red-400 text-xs mb-4 hidden"></div>
        <div class="flex gap-2">
          <button onclick="closeClearModal()" class="flex-1 py-2 text-white/70 hover:bg-white/10 rounded-lg">å–æ¶ˆ</button>
          <button onclick="confirmClearPlayers()" class="flex-1 py-2 bg-red-500 text-white rounded-lg">ç¢ºèªæ¸…é™¤</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const accounts = {
      '410201': 'ABC01', '410202': 'ABC02', '410203': 'ABC03', '410204': 'ABC04',
      '410205': '981103', // ä½ çš„å°ˆå±¬å¸³è™Ÿ
      '410206': 'ABC06', '410207': 'ABC07', '410208': 'ABC08', '410209': 'ABC09',
      'SWRTC': '123456654321'
    };
    const adminClearPassword = '981103990420';

    let gameState = {
      secretNumber: 0, minRange: 1, maxRange: 100, attempts: 0,
      currentPlayerIndex: 0, sessionPlayers: [], guessHistory: [],
      gameActive: false, currentPlayerName: null, isLoggedIn: false, loginAccount: null
    };

    let allPlayers = [];

    // åˆå§‹åŒ–
    async function initApp() {
      if (window.dataSdk) {
        await window.dataSdk.init({ onDataChanged: (data) => { allPlayers = data || []; renderLeaderboard(); } });
      }
      startNewRound();
    }

    // ç™»å…¥é‚è¼¯
    function loginGame() {
      const acc = document.getElementById('login-account').value.trim();
      const pass = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');

      if (accounts[acc] === pass) {
        gameState.isLoggedIn = true;
        gameState.loginAccount = acc;
        document.getElementById('login-section').classList.add('hidden');
        
        let statusTag = (acc === 'SWRTC') ? ' ğŸ‘‘' : (acc === '410205' ? ' âœ¨(ç®¡ç†è€…)' : '');
        document.getElementById('login-status').textContent = `âœ“ å·²ç™»å…¥: ${acc}${statusTag}`;
        document.getElementById('login-status').classList.remove('hidden');
        document.getElementById('join-section').classList.remove('hidden');
        
        // å¤–æ›è§¸ç™¼
        checkCheatCode();
      } else {
        errorDiv.textContent = 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼';
        errorDiv.classList.remove('hidden');
      }
    }

    function checkCheatCode() {
      const msg = document.getElementById('welcome-msg');
      if (gameState.loginAccount === '410205') {
        msg.textContent = `ğŸ¤« å™“... ç­”æ¡ˆæ˜¯ï¼š${gameState.secretNumber}`;
        msg.className = 'text-yellow-400 mt-2 font-black text-lg';
      } else {
        msg.textContent = 'çŒœå‡º 1-100 ä¹‹é–“çš„ç¥ç§˜æ•¸å­—ï¼';
        msg.className = 'text-amber-200/80 mt-2 text-sm';
      }
    }

    function generateSecretNumber() {
      gameState.secretNumber = Math.floor(Math.random() * 100) + 1;
      gameState.minRange = 1; gameState.maxRange = 100; gameState.attempts = 0;
      gameState.guessHistory = []; gameState.gameActive = true;
      updateDisplay();
      checkCheatCode();
    }

    async function joinGame() {
      const name = document.getElementById('player-name-input').value.trim();
      if (!name || gameState.sessionPlayers.includes(name)) return;
      
      gameState.sessionPlayers.push(name);
      gameState.currentPlayerName = name;
      document.getElementById('join-section').classList.add('hidden');
      document.getElementById('joined-section').classList.remove('hidden');
      document.getElementById('guess-section').classList.remove('hidden');
      updateCurrentPlayer();
    }

    async function makeGuess() {
      const input = document.getElementById('guess-input');
      const val = parseInt(input.value);
      if (isNaN(val) || val < 1 || val > 100) return;

      gameState.attempts++;
      const player = gameState.sessionPlayers[gameState.currentPlayerIndex];
      let res = val === gameState.secretNumber ? 'correct' : (val < gameState.secretNumber ? 'higher' : 'lower');
      
      gameState.guessHistory.unshift({ player, guess: val, result: res });
      updateGuessHistory();

      if (res === 'correct') {
        gameState.gameActive = false;
        showWinModal(player);
      } else {
        if (res === 'higher') gameState.minRange = Math.max(gameState.minRange, val + 1);
        else gameState.maxRange = Math.min(gameState.maxRange, val - 1);
        gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.sessionPlayers.length;
        showHint(res === 'higher' ? 'ğŸ“ˆ å¤ªå°äº†ï¼' : 'ğŸ“‰ å¤ªå¤§äº†ï¼', res);
      }
      input.value = ''; updateDisplay(); updateCurrentPlayer();
    }

    // UI æ›´æ–°å·¥å…·
    function updateDisplay() {
      document.getElementById('range-display').textContent = `${gameState.minRange} ~ ${gameState.maxRange}`;
      document.getElementById('attempt-count').textContent = gameState.attempts;
    }

    function updateCurrentPlayer() {
      const el = document.getElementById('current-player-display');
      if (gameState.sessionPlayers.length > 0) {
        el.textContent = `ğŸ¯ ${gameState.sessionPlayers[gameState.currentPlayerIndex]}`;
        el.className = 'text-2xl font-bold text-amber-400';
      }
      document.getElementById('player-count').textContent = `ç›®å‰ ${gameState.sessionPlayers.length} ä½ç©å®¶`;
    }

    function updateGuessHistory() {
      const h = document.getElementById('guess-history');
      h.innerHTML = gameState.guessHistory.map(i => `<div class="p-2 rounded bg-white/5 border border-white/10 text-white flex justify-between"><span>${i.player}: <b>${i.guess}</b></span> <span class="text-xs opacity-60">${i.result}</span></div>`).join('');
    }

    function renderLeaderboard() {
      const l = document.getElementById('leaderboard');
      l.innerHTML = allPlayers.sort((a,b)=>b.score-a.score).slice(0,5).map(p => `<div class="flex justify-between text-white border-b border-white/10 pb-1"><span>${p.player_name}</span><span>${p.score}</span></div>`).join('');
    }

    function showHint(txt, type) {
      const c = document.getElementById('hint-container');
      const b = document.getElementById('hint-box');
      document.getElementById('hint-text').textContent = txt;
      b.className = `rounded-xl p-4 text-center text-white font-bold text-xl hint-${type}`;
      c.classList.remove('hidden');
    }

    function showWinModal(p) {
      document.getElementById('win-message').textContent = `${p} çŒœä¸­äº†ï¼`;
      document.getElementById('win-details').textContent = `ç­”æ¡ˆï¼š${gameState.secretNumber} | æ¬¡æ•¸ï¼š${gameState.attempts}`;
      document.getElementById('win-modal').classList.replace('hidden', 'flex');
    }

    function closeWinModal() { document.getElementById('win-modal').classList.replace('flex', 'hidden'); resetGame(); }
    function resetGame() { generateSecretNumber(); }
    
    function openClearModal() { document.getElementById('clear-modal').classList.replace('hidden', 'flex'); }
    function closeClearModal() { document.getElementById('clear-modal').classList.replace('flex', 'hidden'); }
    function confirmClearPlayers() {
      if (document.getElementById('clear-password').value === adminClearPassword) {
        gameState.sessionPlayers = []; gameState.currentPlayerName = null;
        document.getElementById('joined-section').classList.add('hidden');
        document.getElementById('join-section').classList.remove('hidden');
        document.getElementById('guess-section').classList.add('hidden');
        updateCurrentPlayer(); closeClearModal();
      } else {
        document.getElementById('clear-error').classList.remove('hidden');
        document.getElementById('clear-error').textContent = 'å¯†ç¢¼éŒ¯èª¤ï¼';
      }
    }

    function logoutGame() { location.reload(); }

    initApp();
  </script>
</body>
</html>

